<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\File;
use App\Models\User;
use Spatie\Permission\Models\Role;
use Spatie\Permission\Models\Permission;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        // 1๏ธโฃ ุงูุฃูุนุงู ุงูุนุงูุฉ ููู Resource
        $resourcePrefixes = [
            'view',
            'view_any',
            'create',
            'update',
            'restore',
            'restore_any',
            'replicate',
            'reorder',
            'delete',
            'delete_any',
            'force_delete',
            'force_delete_any',
        ];

        /*
        |--------------------------------------------------------------------------
        | ๐งฉ ุฅูุดุงุก ุตูุงุญูุงุช Resources (ุจูุง ูู ุฐูู ุงููุฌูุฏุงุช ุงููุฑุนูุฉ)
        |--------------------------------------------------------------------------
        */
        $resourcePath = app_path('Filament/Resources');
        if (is_dir($resourcePath)) {
            foreach (File::allFiles($resourcePath) as $file) {
                $fileName = pathinfo($file->getFilename(), PATHINFO_FILENAME);
                $resourceName = strtolower(str_replace('Resource', '', $fileName));

                foreach ($resourcePrefixes as $prefix) {
                    $permName = "{$prefix}_{$resourceName}";
                    Permission::firstOrCreate(['name' => $permName]);
                }
            }
        }

        /*
        |--------------------------------------------------------------------------
        | ๐ ุฅูุดุงุก ุตูุงุญูุงุช Pages (ุจูุง ูู ุฐูู ุงููุฌูุฏุงุช ุงููุฑุนูุฉ)
        |--------------------------------------------------------------------------
        */
        $pagePath = app_path('Filament/Pages');
        if (is_dir($pagePath)) {
            foreach (File::allFiles($pagePath) as $file) {
                $pageName = strtolower(pathinfo($file->getFilename(), PATHINFO_FILENAME));
                Permission::firstOrCreate(['name' => "view_{$pageName}"]);
            }
        }

        /*
        |--------------------------------------------------------------------------
        | ๐งฑ ุฅูุดุงุก ุตูุงุญูุงุช Widgets (ุจูุง ูู ุฐูู ุงููุฌูุฏุงุช ุงููุฑุนูุฉ)
        |--------------------------------------------------------------------------
        */
        $widgetPath = app_path('Filament/Widgets');
        if (is_dir($widgetPath)) {
            foreach (File::allFiles($widgetPath) as $file) {
                $widgetName = strtolower(pathinfo($file->getFilename(), PATHINFO_FILENAME));
                Permission::firstOrCreate(['name' => "view_{$widgetName}"]);
            }
        }

        /*
        |--------------------------------------------------------------------------
        | ๐ ุฅูุดุงุก ุฏูุฑ Super Admin ูุฑุจุทู ุจูู ุงูุตูุงุญูุงุช
        |--------------------------------------------------------------------------
        */
        $superAdminRole = Role::firstOrCreate(['name' => 'super_admin']);
        $superAdminRole->syncPermissions(Permission::all());

        /*
        |--------------------------------------------------------------------------
        | ๐ค ุฅูุดุงุก ูุณุชุฎุฏู Super Admin ุจุงุณุชุฎุฏุงู Factory
        |--------------------------------------------------------------------------
        */
        $superAdmin = User::factory()->create([
            'name' => 'Super Admin',
            'email' => 'admin@example.com',
            'password' => Hash::make('password'),
        ]);

        $superAdmin->assignRole($superAdminRole);

        $this->command->info('โ ุชู ุฅูุดุงุก ุงูุตูุงุญูุงุช ูุงูุฃุฏูุงุฑ ูุงููุณุชุฎุฏู Super Admin ุจูุฌุงุญ ูุน ุฏุนู ุงููุฌูุฏุงุช ุงููุฑุนูุฉ!');
    }
}
